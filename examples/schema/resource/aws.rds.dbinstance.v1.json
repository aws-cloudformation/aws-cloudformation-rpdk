{
    "$id": "aws.rds.dbinstance.v1.json",
    "typeName": "AWS::RDS::DBInstance",
    "description": "The AWS::RDS::DBInstance type creates an Amazon Relational Database Service (Amazon RDS) DB instance.",
    "definitions": {},
    "properties": {
        "AllocatedStorage": {
            "type": "string",
            "description": "The allocated storage size, specified in gigabytes (GB)."
        },
        "AllowMajorVersionUpgrade": {
            "type": "boolean",
            "description": "If you update the EngineVersion property to a version that's different from the DB instance's current major version, set this property to true."
        },
        "AutoMinorVersionUpgrade": {
            "type": "boolean",
            "description": "Indicates that minor engine upgrades are applied automatically to the DB instance during the maintenance window.",
            "default": "true"
        },
        "AvailabilityZone": {
            "description": "The name of the Availability Zone where the DB instance is located.",
            "$ref": "../aws.common.types.v1.json#/definitions/AvailabilityZone"
        },
        "BackupRetentionPeriod": {
            "type": "string",
            "description": "The number of days during which automatic DB snapshots are retained."
        },
        "CharacterSetName": {
            "type": "string",
            "description": "For supported engines, specifies the character set to associate with the DB instance."
        },
        "CopyTagsToSnapshot": {
            "type": "boolean",
            "description": "Indicates whether to copy all of the user-defined tags from the DB instance to snapshots of the DB instance."
        },
        "DBClusterIdentifier": {
            "type": "string",
            "description": "The name of an existing DB cluster that this instance is associated with."
        },
        "DBInstanceClass": {
            "type": "string",
            "description": "The name of the compute and memory capacity classes of the DB instance."
        },
        "DBInstanceIdentifier": {
            "type": "string",
            "description": "A name for the DB instance."
        },
        "DBName": {
            "type": "string",
            "description": "The name of the DB instance that was provided at the time of creation, if one was specified. This same name is returned for the life of the DB instance."
        },
        "DBParameterGroupName": {
            "type": "string",
            "description": "The name of an existing DB parameter group or a reference to an AWS::RDS::DBParameterGroup resource created in the template."
        },
        "DBSecurityGroups": {
            "type": "array",
            "description": "A list of the DB security groups to assign to the DB instance.",
            "items": {
                "type": "string"
            }
        },
        "DBSnapshotIdentifier": {
            "type": "string",
            "description": "The name or Amazon Resource Name (ARN) of the DB snapshot that's used to restore the DB instance."
        },
        "DBSubnetGroupName": {
            "type": "string",
            "description": "A DB subnet group to associate with the DB instance."
        },
        "Domain": {
            "type": "string",
            "description": "For an Amazon RDS DB instance that's running Microsoft SQL Server, the Active Directory directory ID to create the instance in. Amazon RDS uses Windows Authentication to authenticate users that connect to the DB instance."
        },
        "DomainIAMRoleName": {
            "type": "string",
            "description": "The name of an IAM role that Amazon RDS uses when calling the AWS Directory Service APIs."
        },
        "Engine": {
            "type": "string",
            "description": "The database engine that the DB instance uses. This property is optional when you specify the DBSnapshotIdentifier property to create DB instances."
        },
        "EngineVersion": {
            "type": "string",
            "description": "The version number of the database engine that the DB instance uses."
        },
        "Iops": {
            "type": "integer",
            "description": "The number of I/O operations per second (IOPS) that the database provisions.",
            "minimum": 1000
        },
        "KmsKeyId": {
            "type": "string",
            "description": "The ARN of the AWS Key Management Service (AWS KMS) master key that's used to encrypt the DB instance, such as arn:aws:kms:us-east-1:012345678910:key/abcd1234-a123-456a-a12b-a123b4cd56ef."
        },
        "LicenseModel": {
            "type": "string",
            "description": "The license model of the DB instance."
        },
        "MasterUsername": {
            "type": "string",
            "description": "The master user name for the DB instance."
        },
        "MasterUserPassword": {
            "type": "string",
            "description": "The master password for the DB instance."
        },
        "MonitoringInterval": {
            "type": "integer",
            "description": "The interval, in seconds, between points when Amazon RDS collects enhanced monitoring metrics for the DB instance.",
            "enum": [
                0,
                1,
                5,
                10,
                15,
                30,
                60
            ]
        },
        "MonitoringRoleArn": {
            "type": "string",
            "description": "The ARN of the AWS Identity and Access Management (IAM) role that permits Amazon RDS to send enhanced monitoring metrics to Amazon CloudWatch."
        },
        "MultiAZ": {
            "type": "boolean",
            "description": "Specifies if the database instance is a multiple Availability Zone deployment."
        },
        "OptionGroupName": {
            "type": "string",
            "description": "The option group that this DB instance is associated with."
        },
        "Port": {
            "type": "string",
            "description": "The port for the instance."
        },
        "PreferredBackupWindow": {
            "type": "string",
            "description": "The daily time range during which automated backups are performed if automated backups are enabled, as determined by the BackupRetentionPeriod property."
        },
        "PreferredMaintenanceWindow": {
            "type": "string",
            "description": "The weekly time range (in UTC) during which system maintenance can occur."
        },
        "PubliclyAccessible": {
            "type": "boolean",
            "description": "Indicates whether the DB instance is an internet-facing instance."
        },
        "SourceDBInstanceIdentifier": {
            "type": "string",
            "description": "If you want to create a read replica DB instance, specify the ID of the source DB instance."
        },
        "SourceRegion": {
            "type": "string",
            "description": "The ID of the region that contains the source DB instance for the read replica."
        },
        "StorageEncrypted": {
            "type": "boolean",
            "description": "Indicates whether the DB instance is encrypted."
        },
        "StorageType": {
            "type": "string",
            "description": "The storage type associated with this DB instance.",
            "enum": [
                "standard",
                "gp2",
                "io1"
            ]
        },
        "Tags": {
            "description": "An arbitrary set of tags (keyâ€“value pairs) for this DB instance.",
            "$ref": "../aws.common.types.v1.json#/definitions/Tags"
        },
        "Timezone": {
            "type": "string",
            "description": "The time zone of the DB instance, which you can specify to match the time zone of your applications."
        },
        "VPCSecurityGroups": {
            "type": "array",
            "description": "A list of the VPC security group IDs to assign to the DB instance.",
            "items": {
                "type": "string"
            }
        }
    },
    "additionalProperties": false,
    "required": [
        "DBInstanceClass"
    ],
    "allOf": [
        {
            "if": {
                "properties": {
                    "MultiAZ": {
                        "enum": [
                            true
                        ]
                    }
                }
            },
            "then": {
                "description": "Can't set the AvailabilityZone parameter if the MultiAZ is set to true",
                "not": {
                    "required": [
                        "AvailabilityZone"
                    ]
                }
            }
        },
        {
            "if": {
                "anyOf": [
                    {
                        "required": [
                            "DBSnapshotIdentifier"
                        ]
                    },
                    {
                        "required": [
                            "SourceDBInstanceIdentifier"
                        ]
                    }
                ]
            },
            "then": {
                "description": "If you specify the DBSnapshotIdentifier or SourceDBInstanceIdentifier property, don't specify CharacterSetName, MasterUsername or MasterUserPassword. The value is inherited from the snapshot or source DB instance.",
                "allOf": [
                    {
                        "not": {
                            "required": [
                                "CharacterSetName"
                            ]
                        }
                    },
                    {
                        "not": {
                            "required": [
                                "MasterUsername"
                            ]
                        }
                    },
                    {
                        "not": {
                            "required": [
                                "MasterUserPassword"
                            ]
                        }
                    }
                ]
            }
        },
        {
            "if": {
                "properties": {
                    "Engine": {
                        "enum": [
                            "aurora"
                        ]
                    }
                },
                "required": [
                    "Engine"
                ]
            },
            "then": {
                "description": "If you specify aurora as the database engine, you must also specify the DBClusterIdentifier property.",
                "required": [
                    "DBClusterIdentifier"
                ]
            }
        },
        {
            "if": {
                "required": [
                    "DBClusterIdentifier"
                ]
            },
            "then": {
                "description": "If you specify DBClusterIdentifier, specify aurora for the Engine property and don't specify any of the following properties: AllocatedStorage, BackupRetentionPeriod, CharacterSetName, DBName, DBSecurityGroups, MasterUsername, MasterUserPassword, OptionGroupName, PreferredBackupWindow, PreferredMaintenanceWindow, Port, SourceDBInstanceIdentifier, StorageType, or VPCSecurityGroups.",
                "allOf": [
                    {
                        "properties": {
                            "Engine": {
                                "enum": [
                                    "aurora"
                                ]
                            }
                        },
                        "required": [
                            "Engine"
                        ]
                    },
                    {
                        "not": {
                            "anyOf": [
                                {
                                    "required": [
                                        "AllocatedStorage"
                                    ]
                                },
                                {
                                    "required": [
                                        "BackupRetentionPeriod"
                                    ]
                                },
                                {
                                    "required": [
                                        "CharacterSetName"
                                    ]
                                },
                                {
                                    "required": [
                                        "DBName"
                                    ]
                                },
                                {
                                    "required": [
                                        "DBSecurityGroups"
                                    ]
                                },
                                {
                                    "required": [
                                        "MasterUsername"
                                    ]
                                },
                                {
                                    "required": [
                                        "MasterUserPassword"
                                    ]
                                },
                                {
                                    "required": [
                                        "OptionGroupName"
                                    ]
                                },
                                {
                                    "required": [
                                        "PreferredBackupWindow"
                                    ]
                                },
                                {
                                    "required": [
                                        "PreferredMaintenanceWindow"
                                    ]
                                },
                                {
                                    "required": [
                                        "Port"
                                    ]
                                },
                                {
                                    "required": [
                                        "SourceDBInstanceIdentifier"
                                    ]
                                },
                                {
                                    "required": [
                                        "StorageType"
                                    ]
                                },
                                {
                                    "required": [
                                        "VPCSecurityGroups"
                                    ]
                                }
                            ]
                        }
                    }
                ]
            }
        },
        {
            "if": {
                "required": [
                    "MonitoringRoleArn"
                ]
            },
            "then": {
                "description": "If you specify the MonitoringRoleArn property, specify a value other than 0 for MonitoringInterval.",
                "not": {
                    "properties": {
                        "MonitoringInterval": {
                            "enum": [
                                0
                            ]
                        }
                    }
                }
            }
        },
        {
            "if": {
                "not": {
                    "properties": {
                        "MonitoringInterval": {
                            "enum": [
                                0
                            ]
                        }
                    }
                }
            },
            "then": {
                "description": "If you specify a value other than 0 for the MonitoringInterval property, specify a value for MonitoringRoleArn",
                "required": [
                    "MonitoringRoleArn"
                ]
            }
        },
        {
            "if": {
                "anyOf": [
                    {
                        "required": [
                            "DBSnapshotIdentifier"
                        ]
                    },
                    {
                        "required": [
                            "DBClusterIdentifier"
                        ]
                    },
                    {
                        "required": [
                            "SourceDBInstanceIdentifier"
                        ]
                    }
                ]
            },
            "then": {
                "description": "If you specify the DBClusterIdentifier, DBSnapshotIdentifier, or SourceDBInstanceIdentifier property, don't specify StorageEncrypted property.",
                "not": {
                    "required": [
                        "StorageEncrypted"
                    ]
                }
            }
        },
        {
            "description": "If you specify io1 for the StorageType property, you must specify Iops property.",
            "oneOf": [
                {
                    "properties": {
                        "StorageType": {
                            "enum": [
                                "io1"
                            ]
                        }
                    },
                    "required": [
                        "Iops"
                    ]
                },
                {
                    "properties": {
                        "StorageType": {
                            "enum": [
                                "standard",
                                "gp2"
                            ]
                        }
                    }
                }
            ]
        }
    ]
}
